sudo: false         # 开启基于容器的Travis CI任务，让编译效率更高。
language: cpp
os:
  - linux

compiler:
  - gcc

env:
  matrix:
    - ACE=1
  global:
    - CURPATH=$(pwd)
    - ACEDIR=$HOME/Tools
    - ACE_ROOT=$ACEDIR/ACE_wrappers
    - LD_LIBRARY_PATH=$ACE_ROOT/lib:$LD_LIBRARY_PATH
    - COMPILER=g++-7
    - secure: "j47phgTWUecTjPrCzoGsCPiHzvw0QJY2iE/yQ2IL0H2kHE1F984xkCcOaECBlfIFAB1E4f7m1GU1jU0cbpKMAYFAw3M64XnR13wh6Xmc3I6yq0FiUJjZD0XHw+tvYVpZ8uqyLbHwxj2dVF1I0cWtOuqVMnWBEUjOnIt48Swg+RBMA+1Iib7MYy0/zGh/l/b6thza+lu2SGAcwf5zvJECLDigaqctzdyelPQ0IiO1NJuEWnjODJtzbdoOXn720gvbQsCFJQVjWDOUwNCjy01DQLAYKvU2kJDz76RTHGg4wAwNiBsRP1pNx8Mur8NoUx8ZL/sTAU/FvYsSXX04QOMtSDvuwdu/2tr1aZD3X2AURp9ZrNQz5R4aMo67HoTBuxTPU8jAHmF1Skf/vYU0Zk1feqkxKLrREEGBwTy/njnZRr66qXOdOg8IrsJQwfSu7P/X29Qs2CmG5huD5dWzxDMrzmu9H4tiPTRVZ5i9C7UUzc7ey8/kTrN7n6BKJSLCBz3eIUpjHKjtJDhbcz2HWlx1QwI3zmRzDfsd7HQFpp/ZUjvjzHfubEnkBhw2DFRK3xD37ZLCAaddVV+TTWkZyGYZa2QSs0ATh5bgsaSOhDtnq5VhIzSGDPx9V4gmI8hxRfSsAYAoBO0SJtpjDlp6VBaikKV2amVRQjuLQvd8D/PVB/8="


before_install:
  - mkdir -p $ACEDIR
  - cd $ACEDIR
  - wget http://download.dre.vanderbilt.edu/previous_versions/ACE-6.4.0.tar.gz
  - tar zxf ACE-6.4.0.tar.gz
  - echo -n | openssl s_client -connect scan.coverity.com:443 | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' | sudo tee -a /etc/ssl/certs/ca-

before_script:
  - export
  - if [ "$TRAVIS_OS_NAME" == "linux" ]; then 
      echo -e "#include \"ace/config-linux.h\"" >> $ACE_ROOT/ace/config.h; 
      echo -e "#define ACE_HAS_EVENT_POLL" >> $ACE_ROOT/ace/config.h; 
    fi
  - if [ "$TRAVIS_OS_NAME" == "linux" ]; then
      if [ "$CXX" == "g++" ]; then
        echo -e "include \$(ACE_ROOT)/include/makeinclude/platform_linux.GNU" >> $ACE_ROOT/include/makeinclude/platform_macros.GNU;
      else
        echo -e "include \$(ACE_ROOT)/include/makeinclude/platform_linux_clang.GNU" >> $ACE_ROOT/include/makeinclude/platform_macros.GNU;
      fi
    fi

  - cd $ACE_ROOT
  - $ACE_ROOT/bin/mwc.pl -type gnuace ACE.mwc
  - make ACE > /dev/null 2>&1
  - ls $ACE_ROOT/lib/
  
addons:
  coverity_scan:
    project:
      name: "freeeyes/TestTarvisACE"
      description: "Build submitted via Travis CI"
      notification_email: freeeyes@163.com
    build_command_prepend: "cd $ACE_ROOT;$ACE_ROOT/bin/mwc.pl -type gnuace"
    build_command:   "make -j 4"
    branch_pattern: master    
  
script:
  - cd $TRAVIS_BUILD_DIR
  - $ACE_ROOT/bin/mwc.pl -type gnuace
  - make -j 6
  
